var x=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var H=(e,a,l)=>a in e?x(e,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[a]=l,T=(e,a)=>{for(var l in a||(a={}))ae.call(a,l)&&H(e,l,a[l]);if(L)for(var l of L(a))le.call(a,l)&&H(e,l,a[l]);return e},U=(e,a)=>ee(e,te(a));import{r as g}from"./api.16506206505704.js";import{P as se}from"./ProjectEnvSelect.1650620650570.js";import{n as K,i as j,a as R}from"./assert.1650620650570.js";import{a as S}from"./format.1650620650570.js";import{_ as M}from"./index.1650620650570.js";import{y as J,a as G,F as w,t as Q,E as W,d,V as X,q as b,G as $,k as o,f as _,w as Y,j as t,H as O,e as z,h as f,I as ne,J as oe,i as P,P as ue}from"./vendor.1650620650570.js";import"./Api.1650620650570.js";import"./api.16506206505703.js";const ie=J({name:"DateEdit",components:{},props:{visible:{type:Boolean},title:{type:String},redisId:{type:[Number],require:!0},keyInfo:{type:[Object]},operationType:{type:[Number]},stringValue:{type:[String]},setValue:{type:[Array,Object]},hashValue:{type:[Array,Object]}},emits:["valChange","cancel","update:visible"],setup(e,{emit:a}){const l=G({dialogVisible:!1,operationType:1,redisId:"",key:{key:"",type:"string",timed:-1},string:{type:"text",value:""},hash:{value:[{key:"",value:""}]},set:{value:[{value:""}]}}),D=()=>{a("update:visible",!1),a("cancel"),setTimeout(()=>{l.key={key:"",type:"string",timed:-1},l.string.value="",l.string.type="text",l.hash.value=[{key:"",value:""}]},500)};w(()=>e.visible,s=>{l.dialogVisible=s}),w(()=>e.redisId,s=>{l.redisId=s}),w(()=>e.operationType,s=>{l.operationType=s}),w(()=>e.keyInfo,s=>{s&&(l.key=T({},s))},{deep:!0}),w(()=>e.stringValue,s=>{s&&(l.string.value=s)},{deep:!0}),w(()=>e.setValue,s=>{s&&(l.set.value=s)},{deep:!0}),w(()=>e.hashValue,s=>{s&&(l.hash.value=s)},{deep:!0});const V=async()=>{if(K(l.key.key,"key\u4E0D\u80FD\u4E3A\u7A7A"),l.key.type=="string"){K(l.string.value,"value\u4E0D\u80FD\u4E3A\u7A7A");const s={value:S(l.string.value,!0),id:l.redisId};Object.assign(s,l.key),await g.saveStringValue.request(s)}if(l.key.type=="hash"){j(l.hash.value.length>0,"hash\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A");const s={value:l.hash.value,id:l.redisId};Object.assign(s,l.key),await g.saveHashValue.request(s)}if(l.key.type=="set"){j(l.set.value.length>0,"set\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A");const s={value:l.set.value.map(E=>E.value),id:l.redisId};Object.assign(s,l.key),await g.saveSetValue.request(s)}W.success("\u6570\u636E\u4FDD\u5B58\u6210\u529F"),D(),a("valChange")},F=()=>{l.hash.value.push({key:"",value:""})},c=()=>{l.set.value.push({value:""})},h=s=>{if(s=="json"){l.string.value=S(l.string.value,!1);return}s=="text"&&(l.string.value=S(l.string.value,!0))};return U(T({},Q(l)),{saveValue:V,cancel:D,onAddHashValue:F,onAddSetValue:c,onChangeTextType:h})}}),de={id:"string-value-text",style:{width:"100%"}},re={key:1},pe=f("\u6DFB\u52A0"),ce=f("\u5220\u9664"),me={key:2},ye=f("\u6DFB\u52A0"),fe=f("\u5220\u9664"),he={class:"dialog-footer"},ve=f("\u786E \u5B9A"),ke=f("\u53D6 \u6D88");function ge(e,a,l,D,V,F){const c=d("el-input"),h=d("el-form-item"),s=d("el-option"),E=d("el-select"),y=d("el-button"),v=d("el-table-column"),k=d("el-table"),B=d("el-form"),A=d("el-dialog"),i=X("auth");return b(),$(A,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":a[6]||(a[6]=n=>e.dialogVisible=n),"before-close":e.cancel,"show-close":!1,width:"750px","destroy-on-close":!0},{footer:o(()=>[_("div",he,[Y((b(),$(y,{onClick:e.saveValue,type:"primary"},{default:o(()=>[ve]),_:1},8,["onClick"])),[[i,"redis:data:save"]]),t(y,{onClick:a[5]||(a[5]=n=>e.cancel())},{default:o(()=>[ke]),_:1})])]),default:o(()=>[t(B,{"label-width":"85px"},{default:o(()=>[t(h,{prop:"key",label:"key:"},{default:o(()=>[t(c,{disabled:e.operationType==2,modelValue:e.key.key,"onUpdate:modelValue":a[0]||(a[0]=n=>e.key.key=n)},null,8,["disabled","modelValue"])]),_:1}),t(h,{prop:"timed",label:"\u8FC7\u671F\u65F6\u95F4:"},{default:o(()=>[t(c,{modelValue:e.key.timed,"onUpdate:modelValue":a[1]||(a[1]=n=>e.key.timed=n),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])]),_:1}),t(h,{prop:"dataType",label:"\u6570\u636E\u7C7B\u578B:"},{default:o(()=>[t(E,{disabled:e.operationType==2,style:{width:"100%"},modelValue:e.key.type,"onUpdate:modelValue":a[2]||(a[2]=n=>e.key.type=n),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u7C7B\u578B"},{default:o(()=>[t(s,{key:"string",label:"string",value:"string"}),t(s,{key:"hash",label:"hash",value:"hash"}),t(s,{key:"set",label:"set",value:"set"})]),_:1},8,["disabled","modelValue"])]),_:1}),e.key.type=="string"?(b(),$(h,{key:0,prop:"value",label:"\u5185\u5BB9:"},{default:o(()=>[_("div",de,[t(c,{class:"json-text",modelValue:e.string.value,"onUpdate:modelValue":a[3]||(a[3]=n=>e.string.value=n),type:"textarea",autosize:{minRows:10,maxRows:20}},null,8,["modelValue"]),t(E,{class:"text-type-select",onChange:e.onChangeTextType,modelValue:e.string.type,"onUpdate:modelValue":a[4]||(a[4]=n=>e.string.type=n)},{default:o(()=>[t(s,{key:"text",label:"text",value:"text"}),t(s,{key:"json",label:"json",value:"json"})]),_:1},8,["onChange","modelValue"])])]),_:1})):O("",!0),e.key.type=="hash"?(b(),z("span",re,[t(y,{onClick:e.onAddHashValue,icon:"plus",size:"small",plain:"",class:"mt10"},{default:o(()=>[pe]),_:1},8,["onClick"]),t(k,{data:e.hash.value,stripe:"",style:{width:"100%"}},{default:o(()=>[t(v,{prop:"key",label:"key",width:""},{default:o(n=>[t(c,{modelValue:n.row.key,"onUpdate:modelValue":r=>n.row.key=r,clearable:"",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{prop:"value",label:"value","min-width":"200"},{default:o(n=>[t(c,{modelValue:n.row.value,"onUpdate:modelValue":r=>n.row.value=r,clearable:"",type:"textarea",autosize:{minRows:2,maxRows:10},size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{label:"\u64CD\u4F5C",width:"90"},{default:o(n=>[t(y,{type:"danger",onClick:r=>e.hash.value.splice(n.$index,1),icon:"delete",size:"small",plain:""},{default:o(()=>[ce]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):O("",!0),e.key.type=="set"?(b(),z("span",me,[t(y,{onClick:e.onAddSetValue,icon:"plus",size:"small",plain:"",class:"mt10"},{default:o(()=>[ye]),_:1},8,["onClick"]),t(k,{data:e.set.value,stripe:"",style:{width:"100%"}},{default:o(()=>[t(v,{prop:"value",label:"value","min-width":"200"},{default:o(n=>[t(c,{modelValue:n.row.value,"onUpdate:modelValue":r=>n.row.value=r,clearable:"",type:"textarea",autosize:{minRows:2,maxRows:10},size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{label:"\u64CD\u4F5C",width:"90"},{default:o(n=>[t(y,{type:"danger",onClick:r=>e.set.value.splice(n.$index,1),icon:"delete",size:"small",plain:""},{default:o(()=>[fe]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):O("",!0)]),_:1})]),_:1},8,["title","modelValue","before-close"])}var be=M(ie,[["render",ge]]);const Ve=J({name:"DataOperation",components:{DataEdit:be,ProjectEnvSelect:se},setup(){const e=G({loading:!1,cluster:0,redisList:[],query:{envId:0},scanParam:{id:null,cluster:0,match:null,count:10,cursor:0,prevCursor:null},valueDialog:{visible:!1,value:{}},dataEdit:{visible:!1,title:"\u65B0\u589E\u6570\u636E",operationType:1,keyInfo:{type:"string",timed:-1,key:""},stringValue:"",hashValue:[{key:"",value:""}],setValue:[{value:""}]},keys:[],dbsize:0}),a=async()=>{R(e.query.envId,"\u8BF7\u5148\u9009\u62E9\u9879\u76EE\u73AF\u5883");const i=await g.redisList.request(e.query);e.redisList=i.list},l=(i,n)=>{c(),n!=null&&(e.query.envId=n,a())},D=()=>{s(),e.keys=[],e.dbsize=0,F()},V=()=>{j(e.scanParam.id!=null,"\u8BF7\u5148\u9009\u62E9redis"),j(e.scanParam.count<20001,"count\u4E0D\u80FD\u8D85\u8FC720000"),e.loading=!0,e.scanParam.cluster=e.cluster==0?0:1,g.scan.request(e.scanParam).then(i=>{e.keys=i.keys,e.dbsize=i.dbSize,e.scanParam.cursor=i.cursor,e.loading=!1})},F=()=>{e.scanParam.cursor=0,V()},c=()=>{e.redisList=[],e.scanParam.id=null,s(),e.keys=[],e.dbsize=0},h=()=>{s(),e.scanParam.id&&V()},s=()=>{e.scanParam.match=null,e.scanParam.cursor=0,e.scanParam.count=10},E=async i=>{const n=i.type,r=i.key;let p;const C=e.cluster==0?e.scanParam.id:e.cluster,m={cluster:e.cluster,key:i.key,id:C};switch(n){case"string":p=await g.getStringValue.request(m);break;case"hash":p=await g.getHashValue.request(m);break;case"set":p=await g.getSetValue.request(m);break;default:p=null;break}if(R(p,"\u6682\u4E0D\u652F\u6301\u8BE5\u7C7B\u578B\u6570\u636E\u67E5\u770B"),n=="string"&&(e.dataEdit.stringValue=p),n=="set"&&(e.dataEdit.setValue=p.map(u=>({value:u}))),n=="hash"){const u=[],I=Object.keys(p);for(let q=0;q<I.length;q++){const N=I[q],Z=p[N];u.push({key:N,value:Z})}e.dataEdit.hashValue=u}e.dataEdit.keyInfo.type=n,e.dataEdit.keyInfo.timed=i.ttl,e.dataEdit.keyInfo.key=r,e.dataEdit.operationType=2,e.dataEdit.title="\u4FEE\u6539\u6570\u636E",e.dataEdit.visible=!0},y=i=>{ue.confirm("\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u5BF9\u5E94\u7684key , \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{let n=e.cluster==0?e.scanParam.id:e.cluster;g.delKey.request({cluster:e.cluster,key:i,id:n}).then(()=>{W.success("\u5220\u9664\u6210\u529F\uFF01"),V()})}).catch(()=>{})},v=i=>{if(i==-1)return"\u6C38\u4E45";i||(i=0);let n=parseInt(i),r=0,p=0,C=0;n>60&&(r=parseInt(n/60+""),n=n%60,r>60&&(p=parseInt(r/60+""),r=r%60,p>24&&(C=parseInt(p/24+""),p=p%24)));let m=""+n+"s";return r>0&&(m=""+r+"m:"+m),p>0&&(m=""+p+"h:"+m),C>0&&(m=""+C+"d:"+m),m},k=i=>{if(i=="string")return"#E4F5EB";if(i=="hash")return"#F9E2AE";if(i=="set")return"#A8DEE0"},B=()=>{R(e.scanParam.id,"\u8BF7\u5148\u9009\u62E9redis"),e.dataEdit.operationType=1,e.dataEdit.title="\u65B0\u589E\u6570\u636E",e.dataEdit.visible=!0},A=()=>{e.dataEdit.keyInfo={},e.dataEdit.stringValue="",e.dataEdit.setValue=[],e.dataEdit.hashValue=[]};return U(T({},Q(e)),{changeProjectEnv:l,changeRedis:D,clearRedis:c,searchKey:F,scan:V,clear:h,getValue:E,del:y,ttlConveter:v,getTypeColor:k,onAddData:B,onCancelDataEdit:A})}}),Ee={style:{float:"left"}},_e={style:{float:"left"}},Ce={style:{float:"right",color:"#8492a6","margin-left":"6px","font-size":"13px"}},we=f("scan"),De={style:{float:"right"}},Fe=f("\u67E5\u770B"),Be=f("\u5220\u9664"),Ae=_("div",{style:{"text-align":"center","margin-top":"10px"}},null,-1);function Pe(e,a,l,D,V,F){const c=d("el-option"),h=d("el-select"),s=d("el-form-item"),E=d("project-env-select"),y=d("el-col"),v=d("el-input"),k=d("el-button"),B=d("el-form"),A=d("el-row"),i=d("el-table-column"),n=d("el-tag"),r=d("el-table"),p=d("el-card"),C=d("data-edit"),m=X("loading");return b(),z("div",null,[t(p,null,{default:o(()=>[_("div",Ee,[t(A,{type:"flex",justify:"space-between"},{default:o(()=>[t(y,{span:24},{default:o(()=>[t(E,{onChangeProjectEnv:e.changeProjectEnv,onClear:e.clearRedis},{default:o(()=>[t(s,{label:"redis","label-width":"40px"},{default:o(()=>[t(h,{modelValue:e.scanParam.id,"onUpdate:modelValue":a[0]||(a[0]=u=>e.scanParam.id=u),placeholder:"\u8BF7\u9009\u62E9redis",onChange:e.changeRedis,onClear:e.clearRedis,clearable:""},{default:o(()=>[(b(!0),z(ne,null,oe(e.redisList,u=>(b(),$(c,{key:u.id,label:u.host,value:u.id},{default:o(()=>[_("span",_e,P(u.host),1),_("span",Ce,P(`\u5E93: [${u.db}]`),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onChange","onClear"])]),_:1})]),_:1},8,["onChangeProjectEnv","onClear"])]),_:1}),t(y,{class:"mt10"},{default:o(()=>[t(B,{class:"search-form","label-position":"right",inline:!0,"label-width":"60px"},{default:o(()=>[t(s,{label:"key","label-width":"40px"},{default:o(()=>[t(v,{placeholder:"\u652F\u6301*\u6A21\u7CCAkey",style:{width:"240px"},modelValue:e.scanParam.match,"onUpdate:modelValue":a[1]||(a[1]=u=>e.scanParam.match=u),onClear:a[2]||(a[2]=u=>e.clear()),clearable:""},null,8,["modelValue"])]),_:1}),t(s,{label:"count","label-width":"60px"},{default:o(()=>[t(v,{placeholder:"count",style:{width:"62px"},modelValue:e.scanParam.count,"onUpdate:modelValue":a[3]||(a[3]=u=>e.scanParam.count=u)},null,8,["modelValue"])]),_:1}),t(s,null,{default:o(()=>[t(k,{onClick:a[4]||(a[4]=u=>e.searchKey()),type:"success",icon:"search",plain:""}),t(k,{onClick:a[5]||(a[5]=u=>e.scan()),icon:"bottom",plain:""},{default:o(()=>[we]),_:1}),t(k,{type:"primary",icon:"plus",onClick:a[6]||(a[6]=u=>e.onAddData(!1)),plain:""})]),_:1}),_("div",De,[_("span",null,"keys: "+P(e.dbsize),1)])]),_:1})]),_:1})]),_:1})]),Y((b(),$(r,{data:e.keys,stripe:"","highlight-current-row":!0,style:{cursor:"pointer"}},{default:o(()=>[t(i,{"show-overflow-tooltip":"",prop:"key",label:"key"}),t(i,{prop:"type",label:"type",width:"80"},{default:o(u=>[t(n,{color:e.getTypeColor(u.row.type),size:"small"},{default:o(()=>[f(P(u.row.type),1)]),_:2},1032,["color"])]),_:1}),t(i,{prop:"ttl",label:"ttl(\u8FC7\u671F\u65F6\u95F4)",width:"130"},{default:o(u=>[f(P(e.ttlConveter(u.row.ttl)),1)]),_:1}),t(i,{label:"\u64CD\u4F5C"},{default:o(u=>[t(k,{onClick:I=>e.getValue(u.row),type:"success",icon:"search",plain:"",size:"small"},{default:o(()=>[Fe]),_:2},1032,["onClick"]),t(k,{onClick:I=>e.del(u.row.key),type:"danger",icon:"delete",plain:"",size:"small"},{default:o(()=>[Be]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[m,e.loading]])]),_:1}),Ae,t(C,{visible:e.dataEdit.visible,"onUpdate:visible":a[7]||(a[7]=u=>e.dataEdit.visible=u),title:e.dataEdit.title,keyInfo:e.dataEdit.keyInfo,redisId:e.scanParam.id,operationType:e.dataEdit.operationType,stringValue:e.dataEdit.stringValue,setValue:e.dataEdit.setValue,hashValue:e.dataEdit.hashValue,onValChange:e.searchKey,onCancel:e.onCancelDataEdit},null,8,["visible","title","keyInfo","redisId","operationType","stringValue","setValue","hashValue","onValChange","onCancel"])])}var Oe=M(Ve,[["render",Pe]]);export{Oe as default};
