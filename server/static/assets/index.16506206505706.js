var be=Object.defineProperty,ge=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var re=(e,l,h)=>l in e?be(e,l,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[l]=h,R=(e,l)=>{for(var h in l||(l={}))ye.call(l,h)&&re(e,h,l[h]);if(ue)for(var h of ue(l))_e.call(l,h)&&re(e,h,l[h]);return e},O=(e,l)=>ge(e,ve(l));import{y as Z,t as K,r as ne,a as H,F as x,E as L,d as a,V as ee,q as c,e as U,j as t,k as o,f as A,w as T,G as E,I as le,J as te,h as g,P as oe,i as Y,H as q,g as ie,M as Fe,o as Ce}from"./vendor.1650620650570.js";import{A as $}from"./Api.1650620650570.js";import{p as De}from"./api.16506206505703.js";import{S as Ee}from"./SshTerminal.1650620650570.js";import{E as de}from"./Enum.1650620650570.js";import{n as ae}from"./assert.1650620650570.js";import{c as pe}from"./codemirror.1650620650570.js";import{_ as Q,g as we,c as me}from"./index.1650620650570.js";const S={list:$.create("/machines","get"),info:$.create("/machines/{id}/sysinfo","get"),stats:$.create("/machines/{id}/stats","get"),process:$.create("/machines/{id}/process","get"),killProcess:$.create("/machines/{id}/process","delete"),closeCli:$.create("/machines/{id}/close-cli","delete"),saveMachine:$.create("/machines","post"),del:$.create("/machines/{id}","delete"),scripts:$.create("/machines/{machineId}/scripts","get"),runScript:$.create("/machines/{machineId}/scripts/{scriptId}/run","get"),saveScript:$.create("/machines/{machineId}/scripts","post"),deleteScript:$.create("/machines/{machineId}/scripts/{scriptId}","delete"),files:$.create("/machines/{id}/files","get"),lsFile:$.create("/machines/{machineId}/files/{fileId}/read-dir","get"),rmFile:$.create("/machines/{machineId}/files/{fileId}/remove","delete"),uploadFile:$.create("/machines/{machineId}/files/{fileId}/upload?token={token}","post"),fileContent:$.create("/machines/{machineId}/files/{fileId}/read","get"),updateFileContent:$.create("/machines/{machineId}/files/{id}/write","post"),addConf:$.create("/machines/{machineId}/files","post"),delConf:$.create("/machines/{machineId}/files/{id}","delete"),terminal:$.create("/api/machines/{id}/terminal","get")};var W={scriptTypeEnum:new de().add("RESULT","\u6709\u7ED3\u679C",1).add("NO_RESULT","\u65E0\u7ED3\u679C",2).add("REAL_TIME","\u5B9E\u65F6\u4EA4\u4E92",3),FileTypeEnum:new de().add("DIRECTORY","\u76EE\u5F55",1).add("FILE","\u6587\u4EF6",2)};const Be=Z({name:"ScriptEdit",components:{codemirror:pe},props:{visible:{type:Boolean},data:{type:Object},title:{type:String},machineId:{type:Number},isCommon:{type:Boolean}},setup(e,{emit:l}){const{isCommon:h,machineId:u}=K(e),I=ne(null),w=H({dialogVisible:!1,submitDisabled:!1,form:{id:null,name:"",machineId:0,description:"",script:"",params:null,type:null},btnLoading:!1});x(e,f=>{f.data?w.form=R({},f.data):(w.form={},w.form.script=""),w.dialogVisible=f.visible});const b=()=>{w.form.machineId=h.value?9999999:u.value,console.log("machineid:",u),I.value.validate(f=>{if(f)ae(w.form.name,"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"),ae(w.form.description,"\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A"),ae(w.form.script,"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),S.saveScript.request(w.form).then(()=>{L.success("\u4FDD\u5B58\u6210\u529F"),l("submitSuccess"),w.submitDisabled=!1,p()},()=>{w.submitDisabled=!1});else return!1})},p=()=>{l("update:visible",!1),l("cancel")};return O(R({},K(w)),{enums:W,mockDataForm:I,btnOk:b,cancel:p})}}),Ve={class:"mock-data-dialog"},Ie={class:"dialog-footer"},ke=g("\u4FDD \u5B58"),$e=g("\u5173 \u95ED");function Ae(e,l,h,u,I,w){const b=a("el-input"),p=a("el-form-item"),f=a("el-option"),s=a("el-select"),F=a("codemirror"),D=a("el-form"),y=a("el-button"),n=a("el-dialog"),C=ee("auth");return c(),U("div",Ve,[t(n,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":l[6]||(l[6]=i=>e.dialogVisible=i),"close-on-click-modal":!1,"before-close":e.cancel,"show-close":!0,"destroy-on-close":!0,width:"800px"},{footer:o(()=>[A("div",Ie,[T((c(),E(y,{type:"primary",loading:e.btnLoading,onClick:e.btnOk,size:"small",disabled:e.submitDisabled},{default:o(()=>[ke]),_:1},8,["loading","onClick","disabled"])),[[C,"machine:script:save"]]),t(y,{onClick:l[5]||(l[5]=i=>e.cancel()),disabled:e.submitDisabled,size:"small"},{default:o(()=>[$e]),_:1},8,["disabled"])])]),default:o(()=>[t(D,{model:e.form,ref:"mockDataForm","label-width":"70px"},{default:o(()=>[t(p,{prop:"method",label:"\u540D\u79F0"},{default:o(()=>[t(b,{modelValue:e.form.name,"onUpdate:modelValue":l[0]||(l[0]=i=>e.form.name=i),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(p,{prop:"description",label:"\u63CF\u8FF0"},{default:o(()=>[t(b,{modelValue:e.form.description,"onUpdate:modelValue":l[1]||(l[1]=i=>e.form.description=i),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),t(p,{prop:"type",label:"\u7C7B\u578B"},{default:o(()=>[t(s,{modelValue:e.form.type,"onUpdate:modelValue":l[2]||(l[2]=i=>e.form.type=i),"default-first-option":"",style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u7C7B\u578B"},{default:o(()=>[(c(!0),U(le,null,te(e.enums.scriptTypeEnum,i=>(c(),E(f,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{prop:"params",label:"\u53C2\u6570"},{default:o(()=>[t(b,{modelValue:e.form.params,"onUpdate:modelValue":l[3]||(l[3]=i=>e.form.params=i),modelModifiers:{trim:!0},placeholder:"\u53C2\u6570\u6570\u7EC4json\uFF0C\u82E5\u65E0\u53EF\u4E0D\u586B"},null,8,["modelValue"])]),_:1}),t(p,{prop:"script",label:"\u5185\u5BB9",id:"content"},{default:o(()=>[t(F,{ref:"cmEditor",modelValue:e.form.script,"onUpdate:modelValue":l[4]||(l[4]=i=>e.form.script=i),language:"shell",width:"700px"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue","before-close"])])}var Ue=Q(Be,[["render",Ae]]);const Se=Z({name:"ServiceManage",components:{ScriptEdit:Ue,SshTerminal:Ee},props:{visible:{type:Boolean},machineId:{type:Number},title:{type:String}},setup(e,l){const h=ne(null),u=H({dialogVisible:!1,type:0,currentId:null,currentData:null,editDialog:{visible:!1,data:null,title:"",machineId:9999999},scriptTable:[],scriptParamsDialog:{visible:!1,params:{},paramsFormItem:[]},resultDialog:{visible:!1,result:""},terminalDialog:{visible:!1,cmd:"",machineId:0}});x(e,i=>{e.machineId&&I(),u.dialogVisible=i.visible});const I=async()=>{u.currentId=null,u.currentData=null;const i=u.type==0?e.machineId:9999999,k=await S.scripts.request({machineId:i});u.scriptTable=k.list},w=async i=>{if(i.params){u.scriptParamsDialog.paramsFormItem=JSON.parse(i.params),u.scriptParamsDialog.visible=!0;return}p(i)},b=async i=>{u.scriptParamsDialog.visible&&h.value.validate(k=>{if(k)p(i),u.scriptParamsDialog.params={},u.scriptParamsDialog.visible=!1,h.value.resetFields();else return!1})},p=async i=>{const k=i.type==W.scriptTypeEnum.NO_RESULT.value;if(i.type==W.scriptTypeEnum.RESULT.value||k){const z=await S.runScript.request({machineId:e.machineId,scriptId:i.id,params:u.scriptParamsDialog.params});if(k){L.success("\u6267\u884C\u5B8C\u6210");return}u.resultDialog.result=z,u.resultDialog.visible=!0;return}if(i.type==W.scriptTypeEnum.REAL_TIME.value){i=i.script,u.scriptParamsDialog.params&&(i=f(i,u.scriptParamsDialog.params)),u.terminalDialog.cmd=i,u.terminalDialog.visible=!0,u.terminalDialog.machineId=e.machineId;return}};function f(i,k){return i.replace(/\{{.\w+\}}/g,z=>{const M=z.substring(3,z.length-2),d=k[M];return d!=null||d!=null?d:""})}const s=()=>{u.terminalDialog.visible=!1,u.terminalDialog.machineId=0},F=i=>{!i||(u.currentId=i.id,u.currentData=i)},D=i=>{u.editDialog.machineId=e.machineId,u.editDialog.data=i,i?u.editDialog.title="\u67E5\u770B\u7F16\u8F91\u811A\u672C":u.editDialog.title="\u65B0\u589E\u811A\u672C",u.editDialog.visible=!0},y=()=>{I()},n=i=>{oe.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${i.name}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{S.deleteScript.request({machineId:e.machineId,scriptId:i.id}).then(()=>{I()})})},C=()=>{l.emit("update:visible",!1),l.emit("update:machineId",null),l.emit("cancel"),u.scriptTable=[]};return O(R({},K(u)),{paramsForm:h,enums:W,getScripts:I,runScript:w,hasParamsRun:b,closeTermnial:s,choose:F,editScript:D,submitSuccess:y,deleteRow:n,handleClose:C})}}),Te={class:"file-manage"},Pe={class:"toolbar"},qe={style:{float:"left"}},ze={style:{float:"right"}},je=g("\u67E5\u770B"),Me=g("\u6DFB\u52A0"),Le=g("\u5220\u9664"),Ne=A("i",null,null,-1),Re=g("\u786E\u5B9A"),Oe=g("\u6267\u884C"),We={class:"dialog-footer"},Ke=g("\u786E \u5B9A"),Ge={style:{"white-space":"pre-line",padding:"10px",color:"#000000"}};function Je(e,l,h,u,I,w){const b=a("el-option"),p=a("el-select"),f=a("el-button"),s=a("el-radio"),F=a("el-table-column"),D=a("el-table"),y=a("el-dialog"),n=a("el-input"),C=a("el-form-item"),i=a("el-form"),k=a("ssh-terminal"),z=a("script-edit"),M=ee("auth");return c(),U("div",Te,[t(y,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":l[5]||(l[5]=d=>e.dialogVisible=d),"destroy-on-close":!0,"show-close":!0,"before-close":e.handleClose,width:"60%"},{default:o(()=>[A("div",Pe,[A("div",qe,[t(p,{modelValue:e.type,"onUpdate:modelValue":l[0]||(l[0]=d=>e.type=d),onChange:e.getScripts,size:"small",placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[(c(),E(b,{key:0,label:"\u79C1\u6709",value:0})),(c(),E(b,{key:1,label:"\u516C\u5171",value:1}))]),_:1},8,["modelValue","onChange"])]),A("div",ze,[t(f,{onClick:l[1]||(l[1]=d=>e.editScript(e.currentData)),disabled:e.currentId==null,type:"primary",icon:"tickets",size:"small",plain:""},{default:o(()=>[je]),_:1},8,["disabled"]),T((c(),E(f,{type:"primary",onClick:l[2]||(l[2]=d=>e.editScript(null)),icon:"plus",size:"small",plain:""},{default:o(()=>[Me]),_:1})),[[M,"machine:script:save"]]),T((c(),E(f,{disabled:e.currentId==null,type:"danger",onClick:l[3]||(l[3]=d=>e.deleteRow(e.currentData)),icon:"delete",size:"small",plain:""},{default:o(()=>[Le]),_:1},8,["disabled"])),[[M,"machine:script:del"]])])]),t(D,{data:e.scriptTable,onCurrentChange:e.choose,stripe:"",border:"",size:"small",style:{width:"100%"}},{default:o(()=>[t(F,{label:"\u9009\u62E9",width:"55px"},{default:o(d=>[t(s,{modelValue:e.currentId,"onUpdate:modelValue":l[4]||(l[4]=V=>e.currentId=V),label:d.row.id},{default:o(()=>[Ne]),_:2},1032,["modelValue","label"])]),_:1}),t(F,{prop:"name",label:"\u540D\u79F0","min-width":70}),t(F,{prop:"description",label:"\u63CF\u8FF0","min-width":100,"show-overflow-tooltip":""}),t(F,{prop:"name",label:"\u7C7B\u578B","min-width":50},{default:o(d=>[g(Y(e.enums.scriptTypeEnum.getLabelByValue(d.row.type)),1)]),_:1}),t(F,{label:"\u64CD\u4F5C"},{default:o(d=>[d.row.id==null?(c(),E(f,{key:0,onClick:V=>e.addFiles(d.row),type:"success",icon:"el-icon-success",size:"small",plain:""},{default:o(()=>[Re]),_:2},1032,["onClick"])):q("",!0),d.row.id!=null?T((c(),E(f,{key:1,onClick:V=>e.runScript(d.row),type:"primary",icon:"video-play",size:"small",plain:""},{default:o(()=>[Oe]),_:2},1032,["onClick"])),[[M,"machine:script:run"]]):q("",!0)]),_:1})]),_:1},8,["data","onCurrentChange"])]),_:1},8,["title","modelValue","before-close"]),t(y,{title:"\u811A\u672C\u53C2\u6570",modelValue:e.scriptParamsDialog.visible,"onUpdate:modelValue":l[7]||(l[7]=d=>e.scriptParamsDialog.visible=d),width:"400px"},{footer:o(()=>[A("span",We,[t(f,{type:"primary",onClick:l[6]||(l[6]=d=>e.hasParamsRun(e.currentData)),size:"small"},{default:o(()=>[Ke]),_:1})])]),default:o(()=>[t(i,{ref:"paramsForm",model:e.scriptParamsDialog.params,"label-width":"70px",size:"small"},{default:o(()=>[(c(!0),U(le,null,te(e.scriptParamsDialog.paramsFormItem,d=>(c(),E(C,{key:d.name,prop:d.model,label:d.name,required:""},{default:o(()=>[t(n,{modelValue:e.scriptParamsDialog.params[d.model],"onUpdate:modelValue":V=>e.scriptParamsDialog.params[d.model]=V,placeholder:d.placeholder,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop","label"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(y,{title:"\u6267\u884C\u7ED3\u679C",modelValue:e.resultDialog.visible,"onUpdate:modelValue":l[9]||(l[9]=d=>e.resultDialog.visible=d),width:"50%"},{default:o(()=>[A("div",Ge,[t(n,{modelValue:e.resultDialog.result,"onUpdate:modelValue":l[8]||(l[8]=d=>e.resultDialog.result=d),rows:20,type:"textarea"},null,8,["modelValue"])])]),_:1},8,["modelValue"]),e.terminalDialog.visible?(c(),E(y,{key:0,title:"\u7EC8\u7AEF",modelValue:e.terminalDialog.visible,"onUpdate:modelValue":l[10]||(l[10]=d=>e.terminalDialog.visible=d),width:"70%","close-on-click-modal":!1,modal:!1,onClose:e.closeTermnial},{default:o(()=>[t(k,{ref:"terminal",cmd:e.terminalDialog.cmd,machineId:e.terminalDialog.machineId,height:"600px"},null,8,["cmd","machineId"])]),_:1},8,["modelValue","onClose"])):q("",!0),t(z,{visible:e.editDialog.visible,"onUpdate:visible":l[11]||(l[11]=d=>e.editDialog.visible=d),data:e.editDialog.data,"onUpdate:data":l[12]||(l[12]=d=>e.editDialog.data=d),title:e.editDialog.title,machineId:e.editDialog.machineId,"onUpdate:machineId":l[13]||(l[13]=d=>e.editDialog.machineId=d),isCommon:e.type==1,onSubmitSuccess:e.submitSuccess},null,8,["visible","data","title","machineId","isCommon","onSubmitSuccess"])])}var Ye=Q(Se,[["render",Je]]);const Ze=Z({name:"FileManage",components:{codemirror:pe},props:{visible:{type:Boolean},machineId:{type:Number},title:{type:String}},setup(e,{emit:l}){const h=S.addConf,u=S.delConf,I=S.updateFileContent,w=S.files,b=ne(null),p=we("token"),f={tabSize:2,mode:"text/x-sh",theme:"panda-syntax",line:!0,lint:!0,gutters:["CodeMirror-lint-markers"],indentWithTabs:!0,smartIndent:!0,matchBrackets:!0,autofocus:!0,styleSelectedText:!0,styleActiveLine:!0,foldGutter:!0,hintOptions:{completeSingle:!0}},s=H({dialogVisible:!1,form:{id:null,type:null,name:"",remark:""},fileTable:[],btnLoading:!1,fileContent:{fileId:0,content:"",contentVisible:!1,dialogTitle:"",path:"",type:"shell"},tree:{title:"",visible:!1,folder:{id:0},node:{childNodes:[]},resolve:{}},props:{label:"name",children:"zones",isLeaf:"leaf"},progressNum:0,uploadProgressShow:!1,dataObj:{name:"",path:"",type:""},file:null});x(e,r=>{r.machineId&&F(),s.dialogVisible=r.visible});const F=async()=>{const r=await w.request({id:e.machineId});s.fileTable=r.list},D=()=>{s.fileTable=[{}].concat(s.fileTable)},y=async r=>{r.machineId=e.machineId,await h.request(r),L.success("\u6DFB\u52A0\u6210\u529F"),F()},n=(r,_)=>{_.id?oe.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${_.name}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{u.request({machineId:e.machineId,id:_.id}).then(()=>{s.fileTable.splice(r,1)})}):s.fileTable.splice(r,1)},C=r=>{if(r.type==1){s.tree.folder=r,s.tree.title=r.name,d(s.tree.node,s.tree.resolve),s.tree.visible=!0;return}i(r.id,r.path)},i=async(r,_)=>{const P=await S.fileContent.request({fileId:r,path:_,machineId:e.machineId});s.fileContent.content=P,s.fileContent.fileId=r,s.fileContent.dialogTitle=_,s.fileContent.path=_,s.fileContent.type=k(_),s.fileContent.contentVisible=!0},k=r=>r.endsWith(".sh")?"shell":r.endsWith("js")||r.endsWith("json")?"javascript":r.endsWith("Dockerfile")?"dockerfile":r.endsWith("nginx.conf")?"nginx":r.endsWith("sql")?"sql":r.endsWith("yaml")||r.endsWith("yml")?"yaml":r.endsWith("xml")||r.endsWith("html")?"html":"text",z=async()=>{await I.request({content:s.fileContent.content,id:s.fileContent.fileId,path:s.fileContent.path,machineId:e.machineId}),L.success("\u4FEE\u6539\u6210\u529F"),s.fileContent.contentVisible=!1,s.fileContent.content=""},M=()=>{l("update:visible",!1),l("update:machineId",null),l("cancel"),s.fileTable=[],s.tree.folder={id:0}},d=async(r,_)=>{if(typeof _!="function")return;const P=s.tree.folder;if(r.level===0){s.tree.node=r,s.tree.resolve=_;const X=P?P.path:"/";return _([{name:X,type:"d",path:X}])}let J;const N=r.data;!N||N.name==N.path?J=P.path:J=N.path;const se=await S.lsFile.request({fileId:P.id,machineId:e.machineId,path:J});for(const X of se)X.type!="d"&&(X.leaf=!0);return _(se)},V=(r,_)=>{const P=_.path;oe.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${P}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{S.rmFile.request({fileId:s.tree.folder.id,path:P,machineId:e.machineId}).then(()=>{L.success("\u5220\u9664\u6210\u529F"),b.value.remove(r)})}).catch(()=>{})},m=(r,_)=>{const P=document.createElement("a");P.setAttribute("href",`${me.baseApiUrl}/machines/${e.machineId}/files/${s.tree.folder.id}/read?type=1&path=${_.path}&token=${p}`),P.click()},j=r=>{s.uploadProgressShow=!0;let _=r.loaded/r.total*100|0;s.progressNum=_},v=r=>{const _=new FormData;_.append("file",r.file),_.append("path",s.dataObj.path),_.append("machineId",e.machineId),_.append("fileId",s.tree.folder.id),_.append("token",p),S.uploadFile.request(_,{url:`${me.baseApiUrl}/machines/${e.machineId}/files/${s.tree.folder.id}/upload?token=${p}`,headers:{"Content-Type":"multipart/form-data; boundary=----WebKitFormBoundaryF1uyUD0tWdqmJqpl"},onUploadProgress:j,baseURL:"",timeout:60*60*1e3}).then(()=>{L.success("\u4E0A\u4F20\u6210\u529F"),setTimeout(()=>{s.uploadProgressShow=!1},3e3)}).catch(()=>{s.uploadProgressShow=!1})},B=r=>{r.code!==200&&L.error(r.msg)},G=r=>{s.file=r},ce=(r,_)=>{_&&(s.dataObj=r)},fe=r=>{const _=r.path;return["/","//","/usr","/usr/","/usr/bin","/opt","/run","/etc","/proc","/var","/mnt","/boot","/dev","/home","/media","/root"].indexOf(_)!=-1},he=r=>{const _=Number(r);if(r&&!isNaN(_)){const P=["B","KB","MB","GB","TB","PB","EB","ZB","YB","BB"];let J=0,N=_;if(_>=1024)for(;N>1024;)N=N/1024,J++;return`${N.toFixed(2)}${P[J]}`}return"-"};return O(R({},K(s)),{fileTree:b,enums:W,token:p,cmOptions:f,add:D,getFiles:F,addFiles:y,deleteRow:n,getConf:C,getFileContent:i,updateContent:z,handleClose:M,loadNode:d,deleteFile:V,downloadFile:m,getUploadFile:v,beforeUpload:G,getFilePath:ce,uploadSuccess:B,dontOperate:fe,formatFileSize:he})}}),He={class:"file-manage"},Qe={class:"toolbar"},Xe={style:{float:"right"}},xe=g("\u6DFB\u52A0"),el=g("\u786E\u5B9A"),ll=g("\u67E5\u770B"),tl=g("\u5220\u9664"),ol={style:{height:"45vh",overflow:"auto"}},nl={class:"custom-tree-node"},il={class:"el-dropdown-link"},al={key:0},sl={key:1},ul={key:2},rl={style:{display:"inline-block"}},dl={key:0,style:{color:"#67c23a"}},ml=g(" \u67E5\u770B "),pl=g(" \u4E0A\u4F20 "),cl=g("\u4E0B\u8F7D"),fl=g("\u5220\u9664 "),hl={class:"dialog-footer"},bl=g("\u4FDD \u5B58"),gl=g("\u5173 \u95ED");function vl(e,l,h,u,I,w){const b=a("el-button"),p=a("el-input"),f=a("el-table-column"),s=a("el-option"),F=a("el-select"),D=a("el-table"),y=a("el-dialog"),n=a("el-progress"),C=a("SvgIcon"),i=a("el-link"),k=a("el-dropdown-item"),z=a("el-upload"),M=a("el-dropdown-menu"),d=a("el-dropdown"),V=a("el-tree"),m=a("codemirror"),j=ee("auth");return c(),U("div",He,[t(y,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":l[0]||(l[0]=v=>e.dialogVisible=v),"show-close":!0,"before-close":e.handleClose,width:"800px"},{default:o(()=>[A("div",Qe,[A("div",Xe,[T((c(),E(b,{type:"primary",onClick:e.add,icon:"plus",size:"small",plain:""},{default:o(()=>[xe]),_:1},8,["onClick"])),[[j,"machine:file:add"]])])]),t(D,{data:e.fileTable,stripe:"",style:{width:"100%"}},{default:o(()=>[t(f,{prop:"name",label:"\u540D\u79F0",width:""},{default:o(v=>[t(p,{modelValue:v.row.name,"onUpdate:modelValue":B=>v.row.name=B,size:"small",disabled:v.row.id!=null,clearable:""},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),t(f,{prop:"name",label:"\u7C7B\u578B","min-width":"50px"},{default:o(v=>[t(F,{disabled:v.row.id!=null,size:"small",modelValue:v.row.type,"onUpdate:modelValue":B=>v.row.type=B,style:{width:"100px"},placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[(c(!0),U(le,null,te(e.enums.FileTypeEnum,B=>(c(),E(s,{key:B.value,label:B.label,value:B.value},null,8,["label","value"]))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])]),_:1}),t(f,{prop:"path",label:"\u8DEF\u5F84",width:""},{default:o(v=>[t(p,{modelValue:v.row.path,"onUpdate:modelValue":B=>v.row.path=B,disabled:v.row.id!=null,size:"small",clearable:""},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),t(f,{label:"\u64CD\u4F5C",width:""},{default:o(v=>[v.row.id==null?(c(),E(b,{key:0,onClick:B=>e.addFiles(v.row),type:"success",icon:"success-filled",size:"small",plain:""},{default:o(()=>[el]),_:2},1032,["onClick"])):q("",!0),v.row.id!=null?(c(),E(b,{key:1,onClick:B=>e.getConf(v.row),type:"primary",icon:"tickets",size:"small",plain:""},{default:o(()=>[ll]),_:2},1032,["onClick"])):q("",!0),T((c(),E(b,{type:"danger",onClick:B=>e.deleteRow(v.$index,v.row),icon:"delete",size:"small",plain:""},{default:o(()=>[tl]),_:2},1032,["onClick"])),[[j,"machine:file:del"]])]),_:1})]),_:1},8,["data"])]),_:1},8,["title","modelValue","before-close"]),t(y,{title:e.tree.title,modelValue:e.tree.visible,"onUpdate:modelValue":l[1]||(l[1]=v=>e.tree.visible=v),"close-on-click-modal":!1,width:"680px"},{default:o(()=>[e.uploadProgressShow?(c(),E(n,{key:0,style:{width:"90%","margin-left":"20px"},"text-inside":!0,"stroke-width":20,percentage:e.progressNum},null,8,["percentage"])):q("",!0),A("div",ol,[e.tree.visible?(c(),E(V,{key:0,ref:"fileTree",load:e.loadNode,props:e.props,lazy:"","node-key":"id","expand-on-click-node":!0},{default:o(({node:v,data:B})=>[A("span",nl,[t(d,{size:"small",onVisibleChange:G=>e.getFilePath(B,G),trigger:"contextmenu"},{dropdown:o(()=>[t(M,null,{default:o(()=>[B.type=="-"&&B.size<1*1024*1024?(c(),E(k,{key:0},{default:o(()=>[t(i,{onClick:ie(G=>e.getFileContent(e.tree.folder.id,B.path),["prevent"]),type:"info",icon:"view",underline:!1},{default:o(()=>[ml]),_:2},1032,["onClick"])]),_:2},1024)):q("",!0),T((c(),U("span",null,[B.type=="d"?(c(),E(k,{key:0},{default:o(()=>[t(z,{"before-upload":e.beforeUpload,"on-success":e.uploadSuccess,action:"","http-request":e.getUploadFile,headers:{token:e.token},"show-file-list":!1,name:"file",style:{display:"inline-block","margin-left":"2px"}},{default:o(()=>[t(i,{icon:"upload",underline:!1},{default:o(()=>[pl]),_:1})]),_:1},8,["before-upload","on-success","http-request","headers"])]),_:1})):q("",!0)])),[[j,"machine:file:upload"]]),T((c(),U("span",null,[B.type=="-"?(c(),E(k,{key:0},{default:o(()=>[t(i,{onClick:ie(G=>e.downloadFile(v,B),["prevent"]),type:"primary",icon:"download",underline:!1,style:{"margin-left":"2px"}},{default:o(()=>[cl]),_:2},1032,["onClick"])]),_:2},1024)):q("",!0)])),[[j,"machine:file:write"]]),T((c(),U("span",null,[e.dontOperate(B)?q("",!0):(c(),E(k,{key:0},{default:o(()=>[t(i,{onClick:ie(G=>e.deleteFile(v,B),["prevent"]),type:"danger",icon:"delete",underline:!1,style:{"margin-left":"2px"}},{default:o(()=>[fl]),_:2},1032,["onClick"])]),_:2},1024))])),[[j,"machine:file:rm"]])]),_:2},1024)]),default:o(()=>[A("span",il,[B.type=="d"&&!v.expanded?(c(),U("span",al,[t(C,{name:"folder"})])):q("",!0),B.type=="d"&&v.expanded?(c(),U("span",sl,[t(C,{name:"folder-opened"})])):q("",!0),B.type=="-"?(c(),U("span",ul,[t(C,{name:"document"})])):q("",!0),A("span",rl,[g(Y(v.label)+" ",1),B.type=="-"?(c(),U("span",dl,"\xA0\xA0["+Y(e.formatFileSize(B.size))+"]",1)):q("",!0)])])]),_:2},1032,["onVisibleChange"])])]),_:1},8,["load","props"])):q("",!0)])]),_:1},8,["title","modelValue"]),t(y,{"destroy-on-close":!0,title:e.fileContent.dialogTitle,modelValue:e.fileContent.contentVisible,"onUpdate:modelValue":l[4]||(l[4]=v=>e.fileContent.contentVisible=v),"close-on-click-modal":!1,top:"5vh",width:"70%"},{footer:o(()=>[A("div",hl,[T((c(),E(b,{type:"primary",onClick:e.updateContent},{default:o(()=>[bl]),_:1},8,["onClick"])),[[j,"machine:file:write"]]),t(b,{onClick:l[3]||(l[3]=v=>e.fileContent.contentVisible=!1)},{default:o(()=>[gl]),_:1})])]),default:o(()=>[A("div",null,[t(m,{"can-change-mode":!0,ref:"cmEditor",modelValue:e.fileContent.content,"onUpdate:modelValue":l[2]||(l[2]=v=>e.fileContent.content=v),language:e.fileContent.type},null,8,["modelValue","language"])])]),_:1},8,["title","modelValue"])])}var yl=Q(Ze,[["render",vl]]);const _l=Z({name:"MachineEdit",props:{visible:{type:Boolean},projects:{type:Array},machine:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:l}){const h=ne(null),u=H({dialogVisible:!1,projects:[],form:{id:null,projectId:null,projectName:null,name:null,port:22,username:null,password:null},btnLoading:!1,rules:{projectId:[{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE",trigger:["change","blur"]}],envId:[{required:!0,message:"\u8BF7\u9009\u62E9\u73AF\u5883",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u522B\u540D",trigger:["change","blur"]}],ip:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673Aip",trigger:["change","blur"]}],port:[{required:!0,message:"\u8BF7\u8F93\u5165\u7AEF\u53E3",trigger:["change","blur"]}],username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["change","blur"]}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:["change","blur"]}]}});x(e,async p=>{u.dialogVisible=p.visible,u.projects=p.projects,p.machine?u.form=R({},p.machine):u.form={port:22}});const I=p=>{for(let f of u.projects)f.id==p&&(u.form.projectName=f.name)},w=async()=>{h.value.validate(p=>{if(p)S.saveMachine.request(u.form).then(()=>{L.success("\u4FDD\u5B58\u6210\u529F"),l("val-change",u.form),u.btnLoading=!0,setTimeout(()=>{u.btnLoading=!1},1e3),b()});else return L.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},b=()=>{l("update:visible",!1),l("cancel"),setTimeout(()=>{h.value.resetFields(),u.form={}},200)};return O(R({},K(u)),{machineForm:h,changeProject:I,btnOk:w,cancel:b})}}),Fl={class:"dialog-footer"},Cl=g("\u786E \u5B9A"),Dl=g("\u53D6 \u6D88");function El(e,l,h,u,I,w){const b=a("el-option"),p=a("el-select"),f=a("el-form-item"),s=a("el-input"),F=a("el-form"),D=a("el-button"),y=a("el-dialog");return c(),U("div",null,[t(y,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":l[7]||(l[7]=n=>e.dialogVisible=n),"show-close":!1,"before-close":e.cancel,width:"35%"},{footer:o(()=>[A("div",Fl,[t(D,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:o(()=>[Cl]),_:1},8,["loading","onClick"]),t(D,{onClick:l[6]||(l[6]=n=>e.cancel())},{default:o(()=>[Dl]),_:1})])]),default:o(()=>[t(F,{model:e.form,ref:"machineForm",rules:e.rules,"label-width":"85px"},{default:o(()=>[t(f,{prop:"projectId",label:"\u9879\u76EE:",required:""},{default:o(()=>[t(p,{style:{width:"100%"},modelValue:e.form.projectId,"onUpdate:modelValue":l[0]||(l[0]=n=>e.form.projectId=n),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",onChange:e.changeProject,filterable:""},{default:o(()=>[(c(!0),U(le,null,te(e.projects,n=>(c(),E(b,{key:n.id,label:`${n.name} [${n.remark}]`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),t(f,{prop:"name",label:"\u540D\u79F0:",required:""},{default:o(()=>[t(s,{modelValue:e.form.name,"onUpdate:modelValue":l[1]||(l[1]=n=>e.form.name=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u673A\u5668\u522B\u540D","auto-complete":"off"},null,8,["modelValue"])]),_:1}),t(f,{prop:"ip",label:"ip:",required:""},{default:o(()=>[t(s,{modelValue:e.form.ip,"onUpdate:modelValue":l[2]||(l[2]=n=>e.form.ip=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673Aip","auto-complete":"off"},null,8,["modelValue"])]),_:1}),t(f,{prop:"port",label:"port:",required:""},{default:o(()=>[t(s,{type:"number",modelValue:e.form.port,"onUpdate:modelValue":l[3]||(l[3]=n=>e.form.port=n),modelModifiers:{number:!0},placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3"},null,8,["modelValue"])]),_:1}),t(f,{prop:"username",label:"\u7528\u6237\u540D:",required:""},{default:o(()=>[t(s,{modelValue:e.form.username,"onUpdate:modelValue":l[4]||(l[4]=n=>e.form.username=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),t(f,{prop:"password",label:"\u5BC6\u7801:",required:""},{default:o(()=>[t(s,{type:"password","show-password":"",modelValue:e.form.password,"onUpdate:modelValue":l[5]||(l[5]=n=>e.form.password=n),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",autocomplete:"new-password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}var wl=Q(_l,[["render",El]]);const Bl=Z({name:"ProcessList",components:{},props:{visible:{type:Boolean},machineId:{type:Number},title:{type:String}},setup(e,l){const h=H({dialogVisible:!1,params:{name:"",sortType:"1",count:"10",id:0},processList:[]});x(e,p=>{e.machineId&&(h.params.id=e.machineId,u()),h.dialogVisible=p.visible});const u=async()=>{const f=(await S.process.request(h.params)).split(`
`),s=[],F=h.params.name==""?1:0;for(let D=F;D<f.length;D++){const n=f[D].split(/\s+/);if(n.length<2)continue;let C=n[10];if(!(h.params.name&&(C=="bash"||C=="grep"))){for(let i=10;i<n.length-1;i++)C+=" "+n[i+1];s.push({user:n[0],pid:n[1],cpu:n[2],mem:n[3],vsz:w(n[4]),rss:w(n[5]),stat:n[7],start:n[8],time:n[9],command:C})}}h.processList=s},I=async p=>{await S.killProcess.request({pid:p,id:h.params.id}),L.success("kill success"),h.params.name="",u()},w=p=>(parseInt(p)/1024).toFixed(2)+"M",b=()=>{l.emit("update:visible",!1),l.emit("update:machineId",null),l.emit("cancel"),h.params={name:"",sortType:"1",count:"10",id:0},h.processList=[]};return O(R({},K(h)),{getProcess:u,confirmKillProcess:I,enums:W,handleClose:b})}}),Vl={class:"file-manage"},Il={class:"toolbar"},kl=g("\u5237\u65B0"),$l=g(" VSZ "),Al=g(" RSS "),Ul=g(" STAT "),Sl=g(" START "),Tl=g(" TIME "),Pl=g("\u7EC8\u6B62");function ql(e,l,h,u,I,w){const b=a("el-input"),p=a("el-col"),f=a("el-option"),s=a("el-select"),F=a("el-button"),D=a("el-row"),y=a("el-table-column"),n=a("question-filled"),C=a("el-icon"),i=a("el-tooltip"),k=a("el-popconfirm"),z=a("el-table"),M=a("el-dialog"),d=ee("auth");return c(),U("div",Vl,[t(M,{title:"\u8FDB\u7A0B\u4FE1\u606F",modelValue:e.dialogVisible,"onUpdate:modelValue":l[3]||(l[3]=V=>e.dialogVisible=V),"destroy-on-close":!0,"show-close":!0,"before-close":e.handleClose,width:"65%"},{default:o(()=>[A("div",Il,[t(D,null,{default:o(()=>[t(p,{span:4},{default:o(()=>[t(b,{size:"small",placeholder:"\u8FDB\u7A0B\u540D",modelValue:e.params.name,"onUpdate:modelValue":l[0]||(l[0]=V=>e.params.name=V),plain:"",clearable:""},null,8,["modelValue"])]),_:1}),t(p,{span:4,class:"ml5"},{default:o(()=>[t(s,{onChange:e.getProcess,size:"small",modelValue:e.params.sortType,"onUpdate:modelValue":l[1]||(l[1]=V=>e.params.sortType=V),placeholder:"\u8BF7\u9009\u62E9\u6392\u5E8F\u7C7B\u578B"},{default:o(()=>[t(f,{key:"cpu",label:"cpu\u964D\u5E8F",value:"1"}),t(f,{key:"cpu",label:"mem\u964D\u5E8F",value:"2"})]),_:1},8,["onChange","modelValue"])]),_:1}),t(p,{span:4,class:"ml5"},{default:o(()=>[t(s,{onChange:e.getProcess,size:"small",modelValue:e.params.count,"onUpdate:modelValue":l[2]||(l[2]=V=>e.params.count=V),placeholder:"\u8BF7\u9009\u62E9\u8FDB\u7A0B\u4E2A\u6570"},{default:o(()=>[t(f,{key:"10",label:"10",value:"10"}),t(f,{key:"15",label:"15",value:"15"}),t(f,{key:"20",label:"20",value:"20"}),t(f,{key:"25",label:"25",value:"25"})]),_:1},8,["onChange","modelValue"])]),_:1}),t(p,{span:6},{default:o(()=>[t(F,{class:"ml5",onClick:e.getProcess,type:"primary",icon:"tickets",size:"small",plain:""},{default:o(()=>[kl]),_:1},8,["onClick"])]),_:1})]),_:1})]),t(z,{data:e.processList,size:"small",style:{width:"100%"}},{default:o(()=>[t(y,{prop:"user",label:"USER","min-width":50}),t(y,{prop:"pid",label:"PID","min-width":50,"show-overflow-tooltip":""}),t(y,{prop:"cpu",label:"%CPU","min-width":40}),t(y,{prop:"mem",label:"%MEM","min-width":42}),t(y,{prop:"vsz",label:"vsz","min-width":55},{header:o(()=>[$l,t(i,{class:"box-item",effect:"dark",content:"\u865A\u62DF\u5185\u5B58",placement:"top"},{default:o(()=>[t(C,null,{default:o(()=>[t(n)]),_:1})]),_:1})]),_:1}),t(y,{prop:"rss","min-width":52},{header:o(()=>[Al,t(i,{class:"box-item",effect:"dark",content:"\u56FA\u5B9A\u5185\u5B58",placement:"top"},{default:o(()=>[t(C,null,{default:o(()=>[t(n)]),_:1})]),_:1})]),_:1}),t(y,{prop:"stat","min-width":50},{header:o(()=>[Ul,t(i,{class:"box-item",effect:"dark",content:"\u8FDB\u7A0B\u72B6\u6001",placement:"top"},{default:o(()=>[t(C,null,{default:o(()=>[t(n)]),_:1})]),_:1})]),_:1}),t(y,{prop:"start","min-width":50},{header:o(()=>[Sl,t(i,{class:"box-item",effect:"dark",content:"\u542F\u52A8\u65F6\u95F4",placement:"top"},{default:o(()=>[t(C,null,{default:o(()=>[t(n)]),_:1})]),_:1})]),_:1}),t(y,{prop:"time","min-width":50},{header:o(()=>[Tl,t(i,{class:"box-item",effect:"dark",content:"\u8BE5\u8FDB\u7A0B\u5B9E\u9645\u4F7F\u7528CPU\u8FD0\u4F5C\u7684\u65F6\u95F4",placement:"top"},{default:o(()=>[t(C,null,{default:o(()=>[t(n)]),_:1})]),_:1})]),_:1}),t(y,{prop:"command",label:"command","min-width":120,"show-overflow-tooltip":""}),t(y,{label:"\u64CD\u4F5C"},{default:o(V=>[t(k,{title:"\u786E\u5B9A\u7EC8\u6B62\u8BE5\u8FDB\u7A0B?",onConfirm:m=>e.confirmKillProcess(V.row.pid)},{reference:o(()=>[T((c(),E(F,{type:"danger",icon:"delete",size:"small",plain:""},{default:o(()=>[Pl]),_:1})),[[d,"machine:killprocess"]])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","before-close"])])}var zl=Q(Bl,[["render",ql]]);const jl=Z({name:"MachineList",components:{ServiceManage:Ye,ProcessList:zl,FileManage:yl,MachineEdit:wl},setup(){const e=Fe(),l=H({projects:[],params:{pageNum:1,pageSize:10,host:null,clusterId:null},data:{list:[],total:10},currentId:null,currentData:null,infoDialog:{visible:!1,info:""},serviceDialog:{visible:!1,machineId:0,title:""},processDialog:{visible:!1,machineId:0},fileDialog:{visible:!1,machineId:0,title:""},monitorDialog:{visible:!1,machineId:0},machineEditDialog:{visible:!1,data:null,title:"\u65B0\u589E\u673A\u5668"}});Ce(async()=>{F(),l.projects=await De.accountProjects.request(null)});const h=n=>{!n||(l.currentId=n.id,l.currentData=n)},u=n=>{const{href:C}=e.resolve({path:"/machine/terminal",query:{id:n.id,name:n.name}});window.open(C,"_blank")},I=async n=>{await S.closeCli.request({id:n.id}),L.success("\u5173\u95ED\u6210\u529F"),F()},w=n=>{let C;n?(l.machineEditDialog.data=l.currentData,C="\u7F16\u8F91\u673A\u5668"):(l.machineEditDialog.data={port:22},C="\u6DFB\u52A0\u673A\u5668"),l.machineEditDialog.title=C,l.machineEditDialog.visible=!0},b=async n=>{try{await oe.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u673A\u5668\u4FE1\u606F? \u8BE5\u64CD\u4F5C\u5C06\u540C\u65F6\u5220\u9664\u811A\u672C\u53CA\u6587\u4EF6\u914D\u7F6E\u4FE1\u606F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await S.del.request({id:n}),L.success("\u64CD\u4F5C\u6210\u529F"),l.currentId=null,l.currentData=null,F()}catch{}},p=n=>{l.serviceDialog.machineId=n.id,l.serviceDialog.visible=!0,l.serviceDialog.title=`${n.name} => ${n.ip}`},f=()=>{l.currentId=null,l.currentData=null,F()},s=n=>{l.fileDialog.visible=!0,l.fileDialog.machineId=n.id,l.fileDialog.title=`${n.name} => ${n.ip}`},F=async()=>{const n=await S.list.request(l.params);l.data=n},D=n=>{l.params.pageNum=n,F()},y=n=>{l.processDialog.machineId=n.id,l.processDialog.visible=!0};return O(R({},K(l)),{choose:h,showTerminal:u,openFormDialog:w,deleteMachine:b,closeCli:I,serviceManager:p,showProcess:y,submitSuccess:f,fileManage:s,search:F,handlePageChange:D})}}),Ml=g("\u6DFB\u52A0"),Ll=g("\u7F16\u8F91"),Nl=g("\u5220\u9664"),Rl=g("\u6587\u4EF6"),Ol={style:{float:"right"}},Wl=A("i",null,null,-1),Kl=g("\u811A\u672C"),Gl=g("\u7EC8\u7AEF"),Jl=g("\u8FDB\u7A0B"),Yl=g("\u5173\u95ED\u8FDE\u63A5");function Zl(e,l,h,u,I,w){const b=a("el-button"),p=a("el-option"),f=a("el-select"),s=a("el-input"),F=a("el-radio"),D=a("el-table-column"),y=a("el-table"),n=a("el-pagination"),C=a("el-row"),i=a("el-card"),k=a("machine-edit"),z=a("process-list"),M=a("service-manage"),d=a("file-manage"),V=ee("auth");return c(),U("div",null,[t(i,null,{default:o(()=>[A("div",null,[T((c(),E(b,{type:"primary",icon:"plus",onClick:l[0]||(l[0]=m=>e.openFormDialog(!1)),plain:""},{default:o(()=>[Ml]),_:1})),[[V,"machine:add"]]),T((c(),E(b,{type:"primary",icon:"edit",disabled:e.currentId==null,onClick:l[1]||(l[1]=m=>e.openFormDialog(e.currentData)),plain:""},{default:o(()=>[Ll]),_:1},8,["disabled"])),[[V,"machine:update"]]),T((c(),E(b,{disabled:e.currentId==null,onClick:l[2]||(l[2]=m=>e.deleteMachine(e.currentId)),type:"danger",icon:"delete"},{default:o(()=>[Nl]),_:1},8,["disabled"])),[[V,"machine:del"]]),T((c(),E(b,{type:"success",icon:"files",disabled:e.currentId==null,onClick:l[3]||(l[3]=m=>e.fileManage(e.currentData)),plain:""},{default:o(()=>[Rl]),_:1},8,["disabled"])),[[V,"machine:file"]]),A("div",Ol,[t(f,{modelValue:e.params.projectId,"onUpdate:modelValue":l[4]||(l[4]=m=>e.params.projectId=m),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",onClear:e.search,filterable:"",clearable:""},{default:o(()=>[(c(!0),U(le,null,te(e.projects,m=>(c(),E(p,{key:m.id,label:`${m.name} [${m.remark}]`,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onClear"]),t(s,{class:"ml5",placeholder:"\u8BF7\u8F93\u5165ip",style:{width:"200px"},modelValue:e.params.ip,"onUpdate:modelValue":l[5]||(l[5]=m=>e.params.ip=m),onClear:e.search,plain:"",clearable:""},null,8,["modelValue","onClear"]),t(b,{class:"ml5",onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])])]),t(y,{data:e.data.list,stripe:"",style:{width:"100%"},onCurrentChange:e.choose},{default:o(()=>[t(D,{label:"\u9009\u62E9",width:"55px"},{default:o(m=>[t(F,{modelValue:e.currentId,"onUpdate:modelValue":l[6]||(l[6]=j=>e.currentId=j),label:m.row.id},{default:o(()=>[Wl]),_:2},1032,["modelValue","label"])]),_:1}),t(D,{prop:"name",label:"\u540D\u79F0","min-width":"130","show-overflow-tooltip":""}),t(D,{prop:"ip",label:"ip:port","min-width":"130"},{default:o(m=>[g(Y(`${m.row.ip}:${m.row.port}`),1)]),_:1}),t(D,{prop:"username",label:"\u7528\u6237\u540D","min-width":"75"}),t(D,{prop:"projectName",label:"\u9879\u76EE","min-width":"120"}),t(D,{prop:"ip",label:"hasCli",width:"70"},{default:o(m=>[g(Y(`${m.row.hasCli?"\u662F":"\u5426"}`),1)]),_:1}),t(D,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4",width:"165"},{default:o(m=>[g(Y(e.$filters.dateFormat(m.row.createTime)),1)]),_:1}),t(D,{prop:"creator",label:"\u521B\u5EFA\u8005","min-width":"60"}),t(D,{label:"\u64CD\u4F5C","min-width":"260",fixed:"right"},{default:o(m=>[t(b,{type:"success",onClick:j=>e.serviceManager(m.row),plain:"",size:"small"},{default:o(()=>[Kl]),_:2},1032,["onClick"]),T((c(),E(b,{type:"primary",onClick:j=>e.showTerminal(m.row),plain:"",size:"small"},{default:o(()=>[Gl]),_:2},1032,["onClick"])),[[V,"machine:terminal"]]),t(b,{onClick:j=>e.showProcess(m.row),plain:"",size:"small"},{default:o(()=>[Jl]),_:2},1032,["onClick"]),t(b,{disabled:!m.row.hasCli,type:"danger",onClick:j=>e.closeCli(m.row),plain:"",size:"small"},{default:o(()=>[Yl]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),t(C,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:o(()=>[t(n,{style:{"text-align":"right"},total:e.data.total,layout:"prev, pager, next, total, jumper","current-page":e.params.pageNum,"onUpdate:current-page":l[7]||(l[7]=m=>e.params.pageNum=m),"page-size":e.params.pageSize,onCurrentChange:e.handlePageChange},null,8,["total","current-page","page-size","onCurrentChange"])]),_:1})]),_:1}),t(k,{title:e.machineEditDialog.title,projects:e.projects,visible:e.machineEditDialog.visible,"onUpdate:visible":l[8]||(l[8]=m=>e.machineEditDialog.visible=m),machine:e.machineEditDialog.data,"onUpdate:machine":l[9]||(l[9]=m=>e.machineEditDialog.data=m),onValChange:e.submitSuccess},null,8,["title","projects","visible","machine","onValChange"]),t(z,{visible:e.processDialog.visible,"onUpdate:visible":l[10]||(l[10]=m=>e.processDialog.visible=m),machineId:e.processDialog.machineId,"onUpdate:machineId":l[11]||(l[11]=m=>e.processDialog.machineId=m)},null,8,["visible","machineId"]),t(M,{title:e.serviceDialog.title,visible:e.serviceDialog.visible,"onUpdate:visible":l[12]||(l[12]=m=>e.serviceDialog.visible=m),machineId:e.serviceDialog.machineId,"onUpdate:machineId":l[13]||(l[13]=m=>e.serviceDialog.machineId=m)},null,8,["title","visible","machineId"]),t(d,{title:e.fileDialog.title,visible:e.fileDialog.visible,"onUpdate:visible":l[14]||(l[14]=m=>e.fileDialog.visible=m),machineId:e.fileDialog.machineId,"onUpdate:machineId":l[15]||(l[15]=m=>e.fileDialog.machineId=m)},null,8,["title","visible","machineId"])])}var at=Q(jl,[["render",Zl]]);export{at as default};
